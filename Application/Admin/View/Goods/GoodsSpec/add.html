<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="/favicon.ico" >
	<link rel="Shortcut Icon" href="/favicon.ico" />
	<!--[if lt IE 9]>
	<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/html5shiv.js"></script>
	<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="__PUBLIC_ADMIN__/static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="__PUBLIC_ADMIN__/static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="__PUBLIC_ADMIN__/lib/Hui-iconfont/1.0.8/iconfont.css" />

	<link rel="stylesheet" type="text/css" href="__PUBLIC_ADMIN__/static/h-ui.admin/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="__PUBLIC_ADMIN__/static/h-ui.admin/css/style.css" />
	<!--[if IE 6]>
	<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<!--/meta 作为公共模版分离出去-->

</head>
<body>
<div class="page-container">
	<!-- 商品信息 -->
    
	<form action="{:U('/Admin/Goods/GoodsSpec/add')}" method="post" class="form form-horizontal" id="form-article-add" enctype="multipart/form-data">


		<input type="hidden" name="goods_id" class="goods_id" value="{$goods.id}">
		
		<volist name="goodsSpec" id="vo">
			
			<div class="row cl">
				<input type="hidden" name="goods_spec_id" class="goods_spec_id" value="{$vo.goods_spec_id}">
				<label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>商品规格</label>
				<div class="formControls col-xs-3 col-sm-1"> <span class="select-box">
					<select name="articlecolumn" class="select select-spec">
						<option value="0">选择商品规格</option>
						<volist name="spec" id="v">{$vo.spec_id}--{$v.spec_id}

							<?php
								if($v['spec_id'] == $vo['spec_id']) {
							?>
								<option value="{$v.spec_id}" selected="selected">{$v.spec_title}</option>
							<?php
							} else {
							?>
								<option value="{$v.spec_id}">{$v.spec_title}</option>
							<?php
							}
							
							?>
							
						</volist>
					</select>
					</span>
				</div>

				<label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>规格属性</label>
				<div class="formControls col-xs-3 col-sm-1"> <span class="select-box">
					<select name="articlecolumn" class="select select-spec-attr">
						<option value="{$vo.addr_id}">{$vo.addr_title}</option>
					</select>
					</span>
				</div>

				<label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>商品增值</label>
				<div class="formControls col-xs-3 col-sm-1">
					<input type="number" step="0.01" class="input-text incre_price" value="{$vo.incre_price}" placeholder="商品增值" id="keywords" name="incre_price">
				</div>

				<label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>商品库存</label>
				<div class="formControls col-xs-3 col-sm-1">
					<input type="number" min="0" max="999999999" class="input-text goods_num" value="{$vo.goods_num}" placeholder="商品库存" id="keywords" name="goods_num">
				</div>

				<div class="formControls col-xs-3 col-sm-2">
					
					<if condition="$vo.status eq 0">
						<button onClick="" class="btn btn-warning radius btn-submit-status" type="button"><i class="Hui-iconfont">&#xe631;</i> 停用</button>
					<elseif condition="$vo.status eq 1"/>
						<button onClick="" class="btn btn-default radius btn-submit-status" type="button"><i class="Hui-iconfont">&#xe601;</i> 启用</button>
					</if>
					<button class="btn btn-secondary radius btn-submit" type="button"
						><i class="Hui-iconfont">&#xe6df;</i>编辑</button>
				</div>
			</div>
		</volist>

		<div class="row cl">
			<label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>商品规格</label>
			<div class="formControls col-xs-3 col-sm-1"> <span class="select-box">
				<select name="articlecolumn" class="select select-spec">
					<option value="0">选择商品规格</option>
					<volist name="spec" id="vo">
						<option value="{$vo.spec_id}">{$vo.spec_title}</option>
					</volist>
				</select>
				</span>
			</div>

			<label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>规格属性</label>
			<div class="formControls col-xs-3 col-sm-1"> <span class="select-box">
				<select name="articlecolumn" class="select select-spec-attr">
					<option value='0'>选择规格属性</option>
				</select>
				</span>
			</div>

			<label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>商品增值</label>
			<div class="formControls col-xs-3 col-sm-1">
				<input type="number" step="0.01" class="input-text incre_price" value="" placeholder="商品增值" id="incre_price" name="incre_price">
			</div>

			<label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>商品库存</label>
			<div class="formControls col-xs-3 col-sm-1">
				<input type="number" min="0" max="999999999" class="input-text goods_num" value="" placeholder="商品库存" id="keywords" name="goods_num">
			</div>

			<div class="formControls col-xs-3 col-sm-2">
				<button onClick="" class="btn btn-secondary radius btn-submit" type="button"
					><i class="Hui-iconfont">&#xe632;</i> 保存</button>
			</div>
		</div>

	</form>
</div>

<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/static/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/My97DatePicker/4.8/WdatePicker.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/webuploader/0.1.5/webuploader.min.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/ueditor/1.4.3/ueditor.config.js"></script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
<script type="text/javascript" src="__PUBLIC_ADMIN__/lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>



<script type="text/javascript">

	_html = '<div class="row cl"><label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>商品规格</label><div class="formControls col-xs-3 col-sm-1"> <span class="select-box"><select name="articlecolumn" class="select select-spec"><option value="0">选择商品规格</option><volist name="spec" id="vo"><option value="{$vo.spec_id}">{$vo.spec_title}</option></volist></select></span></div><label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>规格属性</label><div class="formControls col-xs-3 col-sm-1"> <span class="select-box"><select name="articlecolumn" class="select select-spec-attr"><option value="0">选择规格属性</option></select></span></div><label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>商品增值</label><div class="formControls col-xs-3 col-sm-1"><input type="number" step="0.01" class="input-text incre_price" value="" placeholder="商品增值" id="incre_price" name="incre_price"></div><label class="form-label col-xs-3 col-sm-1"><span class="c-red">*</span>商品库存</label><div class="formControls col-xs-3 col-sm-1"><input type="number" min="0" max="999999999" class="input-text goods_num" value="" placeholder="商品库存" id="keywords" name="goods_num"></div><div class="formControls col-xs-3 col-sm-2"><button class="btn btn-secondary radius btn-submit" type="button"><i class="Hui-iconfont">&#xe632;</i> 保存</button></div></div>';
	// 选择商品规格
	$('form').on('change', ".select-spec", function(){

		spec_id = $(this).val();
		spec_name = $(this).find("option:selected").text();

		// 获取规格的属性
		_option = "<option value='0'>选择规格属性</option>";
		_spec = $(this).parent().parent().parent();
		//console.log(_spec);
  		$.get("{:U('getSpecAttr')}?id="+spec_id,function(data, status){

	    	for (var i = data.length - 1; i >= 0; i--) {
	    		_option += "<option value='"+data[i].addr_id+"'>"+data[i].addr_title+"</option>";
	    	}
	    	
	    	_spec.find('.select-spec-attr').empty();
	    	_spec.find('.select-spec-attr').append(_option)
		});
	});

	// 添加商品规格
	$('form').on('click', '.btn-submit', function(){

		// 商品规格id
		goods_spec_id = $(this).parent().parent().find('.goods_spec_id').val();
		// 商品id
		goods_id = $('.goods_id').val();

		// 获取规格 
		_doc_spec = $(this).parent().parent().find('.select-spec');
		spec_id = _doc_spec.val();
		spec_name = _doc_spec.find("option:selected").text();

		// 获取规格属性
		_doc_spec = $(this).parent().parent().find('.select-spec-attr');
		attr_id = _doc_spec.val();
		attr_name = _doc_spec.find("option:selected").text();

		// 获取商品增值
		incre_price =  $(this).parent().parent().find('.incre_price').val();

		// 获取商品库存
		goods_num =  $(this).parent().parent().find('.goods_num').val();


		//console.log(spec_id, spec_name, attr_id, attr_name,goods_num, incre_price, goods_spec_id);
		 _doc_opt = $(this)
		/* _input = '<input type="hidden" name="goods_spec_id" class="goods_spec_id" value="'+2222+'">';
    	_doc_opt.parent().parent().after(_html)
    	_doc_opt.parent().parent().append(_input);
    	_doc_opt.parent().html('<button class="btn btn-warning radius btn-submit" type="button"><i class="Hui-iconfont">&#xe601;</i> 停用</button><button class="btn btn-secondary radius btn-submit" type="button"><i class="Hui-iconfont">&#xe632;</i> 编辑</button>');
    	return ;*/
		// 提交数据
		$.post("save",{
			goods_spec_id:goods_spec_id,
			goods_id:goods_id, 
			spec_id:spec_id, 
			spec_name:spec_name, 
			attr_id:attr_id, 
			attr_name:attr_name, 
			incre_price:incre_price, 
			goods_num:goods_num, 
		},function(result){
		    	
		    if(result.code == 1){ //添加成功
		    	if(!goods_spec_id) {
					_input = '<input type="hidden" name="goods_spec_id" class="goods_spec_id" value="'+result.goods_spec_id+'">';
			    	_doc_opt.parent().parent().after(_html)
			    	_doc_opt.parent().parent().append(_input);
			    	_doc_opt.parent().html('<button class="btn btn-warning radius btn-submit" type="button"><i class="Hui-iconfont">&#xe601;</i> 停用</button><button class="btn btn-secondary radius btn-submit" type="button"><i class="Hui-iconfont">&#xe632;</i> 编辑</button>');
		    	}
		    	
		    	layer.msg(result.msg);
		    } else {
		    	layer.msg(result.msg);
		    }
		});
	});

	// 启用停用
	$('.btn-submit-status').click(function(){
		goods_spec_id = $(this).parent().parent().find('.goods_spec_id').val();
		_doc_opt = $(this);
		

		$.post("setSataus", {
			goods_spec_id:goods_spec_id
		}, function(result){
			if(result.code == 1){ // 设置成功!
				layer.msg(result.msg);
				if(result.status == 0){ // 启用 
					_doc_opt.removeClass('btn-default').addClass('btn-warning');
					_doc_opt.parent().parent().find('.btn-submit-status').html('<i class="Hui-iconfont">&#xe631;</i> 启用')
				} else if(result.status == 1){ // 停用
					_doc_opt.removeClass('btn-warning').addClass('btn-default');
					_doc_opt.parent().parent().find('.btn-submit-status').html('<i class="Hui-iconfont">&#xe601;</i> 停用')
				}
			} else {
				layer.msg('设置失败!');
			}
		});
	});
</script>
</body>
</html>